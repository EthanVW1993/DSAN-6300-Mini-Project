{"title":"Q5 - Cancelled Flights","markdown":{"yaml":{"title":"Q5 - Cancelled Flights"},"headingText":"Question 6a","containsRefs":false,"markdown":"\n\n\n** Check if your dataset has any canceled flights.**\n\n## SQL Query for 6a\n\nThe SQL Query used to answer this question is provided below.\n\n``` sql\nSELECT COUNT(*) AS canceled_flights\nFROM al_perf\nWHERE Cancelled = 1;\n```\n# Question 6b\n\n** For each departure airport, find the most frequent cancellation reason.**\n```sql\nWITH cancel_counts AS (\n    SELECT \n        OriginCityName AS airport_name,\n        Origin AS airport_code,\n        CancellationCode AS reason,\n        COUNT(*) AS cancel_count\n    FROM al_perf\n    WHERE Cancelled = 1\n    GROUP BY OriginCityName, Origin, CancellationCode\n),\nranked AS (\n    SELECT\n        airport_name,\n        airport_code,\n        reason,\n        cancel_count,\n        RANK() OVER (\n            PARTITION BY airport_name\n            ORDER BY cancel_count DESC\n        ) AS rnk\n    FROM cancel_counts\n)\nSELECT\n    airport_name,\n    airport_code,\n    reason,\n    cancel_count\nFROM ranked\nWHERE rnk = 1\nORDER BY airport_name;\n```\n\n## Output\n\nThe output of this SQL query is saved as `Question 6b output.csv`, and is provided below.\n\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)\n\nq6b <- read_csv(\"data/Question 6b output.csv\")\nq6b\n```\n\n\n## Visualization\n\n```{r}\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)\n\n# ----------------------------\n# Load Q6b cancellation data\n# ----------------------------\nq6b <- read_csv(\"data/Question 6b output.csv\")\n\n# ----------------------------\n# Load FAA/OpenFlights Airport Coordinates\n# ----------------------------\nfaa_airports <- read_csv(\n  \"https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat\",\n  col_names = FALSE\n) %>%\n  select(\n    airport_id = X1,\n    airport_name = X2,\n    city = X3,\n    country = X4,\n    IATA = X5,\n    latitude = X7,\n    longitude = X8\n  ) %>%\n  filter(country == \"United States\", !is.na(IATA), IATA != \"\\\\N\")\n\n# ----------------------------\n# Join Q6b cancellations with airport coordinates\n# ----------------------------\nq6_map <- q6b %>%\n  left_join(faa_airports, by = c(\"airport_code\" = \"IATA\"))\n\n# ----------------------------\n# Plot U.S. map with cancellation bubbles\n# ----------------------------\nstates_map <- map_data(\"state\")\n\nggplot() +\n  geom_polygon(\n    data = states_map,\n    aes(x = long, y = lat, group = group),\n    fill = \"gray95\", color = \"white\"\n  ) +\n  geom_point(\n    data = q6_map,\n    aes(x = longitude, y = latitude, size = cancel_count),\n    color = \"#4C72B0\", alpha = 0.7\n  ) +\n  scale_size_continuous(range = c(2, 10)) +\n  coord_fixed(1.3) +\n  labs(\n    title = \"Flight Cancellations by Airport (Q6b)\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    size = \"Cancellation Count\"\n  ) +\n  theme_minimal(base_size = 14)\n```\n\nThe map shows how flight cancellations in March 2018 are distributed across U.S. airports, with larger points indicating airports experiencing higher cancellation volumes. Most cancellations cluster around major hubs in the eastern and central United States, where traffic density is highest. A few western airports also show elevated cancellation counts, highlighting how both weather patterns and congestion can drive regional differences in flight disruptions.\n","srcMarkdownNoYaml":"\n\n# Question 6a\n\n** Check if your dataset has any canceled flights.**\n\n## SQL Query for 6a\n\nThe SQL Query used to answer this question is provided below.\n\n``` sql\nSELECT COUNT(*) AS canceled_flights\nFROM al_perf\nWHERE Cancelled = 1;\n```\n# Question 6b\n\n** For each departure airport, find the most frequent cancellation reason.**\n```sql\nWITH cancel_counts AS (\n    SELECT \n        OriginCityName AS airport_name,\n        Origin AS airport_code,\n        CancellationCode AS reason,\n        COUNT(*) AS cancel_count\n    FROM al_perf\n    WHERE Cancelled = 1\n    GROUP BY OriginCityName, Origin, CancellationCode\n),\nranked AS (\n    SELECT\n        airport_name,\n        airport_code,\n        reason,\n        cancel_count,\n        RANK() OVER (\n            PARTITION BY airport_name\n            ORDER BY cancel_count DESC\n        ) AS rnk\n    FROM cancel_counts\n)\nSELECT\n    airport_name,\n    airport_code,\n    reason,\n    cancel_count\nFROM ranked\nWHERE rnk = 1\nORDER BY airport_name;\n```\n\n## Output\n\nThe output of this SQL query is saved as `Question 6b output.csv`, and is provided below.\n\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)\n\nq6b <- read_csv(\"data/Question 6b output.csv\")\nq6b\n```\n\n\n## Visualization\n\n```{r}\n```{r message=FALSE, warning=FALSE}\nlibrary(tidyverse)\n\n# ----------------------------\n# Load Q6b cancellation data\n# ----------------------------\nq6b <- read_csv(\"data/Question 6b output.csv\")\n\n# ----------------------------\n# Load FAA/OpenFlights Airport Coordinates\n# ----------------------------\nfaa_airports <- read_csv(\n  \"https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat\",\n  col_names = FALSE\n) %>%\n  select(\n    airport_id = X1,\n    airport_name = X2,\n    city = X3,\n    country = X4,\n    IATA = X5,\n    latitude = X7,\n    longitude = X8\n  ) %>%\n  filter(country == \"United States\", !is.na(IATA), IATA != \"\\\\N\")\n\n# ----------------------------\n# Join Q6b cancellations with airport coordinates\n# ----------------------------\nq6_map <- q6b %>%\n  left_join(faa_airports, by = c(\"airport_code\" = \"IATA\"))\n\n# ----------------------------\n# Plot U.S. map with cancellation bubbles\n# ----------------------------\nstates_map <- map_data(\"state\")\n\nggplot() +\n  geom_polygon(\n    data = states_map,\n    aes(x = long, y = lat, group = group),\n    fill = \"gray95\", color = \"white\"\n  ) +\n  geom_point(\n    data = q6_map,\n    aes(x = longitude, y = latitude, size = cancel_count),\n    color = \"#4C72B0\", alpha = 0.7\n  ) +\n  scale_size_continuous(range = c(2, 10)) +\n  coord_fixed(1.3) +\n  labs(\n    title = \"Flight Cancellations by Airport (Q6b)\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    size = \"Cancellation Count\"\n  ) +\n  theme_minimal(base_size = 14)\n```\n\nThe map shows how flight cancellations in March 2018 are distributed across U.S. airports, with larger points indicating airports experiencing higher cancellation volumes. Most cancellations cluster around major hubs in the eastern and central United States, where traffic density is highest. A few western airports also show elevated cancellation counts, highlighting how both weather patterns and congestion can drive regional differences in flight disruptions.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"q6.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","editor":"visual","theme":["cosmo","brand"],"title":"Q5 - Cancelled Flights"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}