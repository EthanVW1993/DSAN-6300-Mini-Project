{
  "hash": "e870363ccc7cee36c143494b52e1b745",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Q5 - Cancelled Flights\"\n---\n\n# Question 6a\n\n** Check if your dataset has any canceled flights.**\n\n## SQL Query for 6a\n\nThe SQL Query used to answer this question is provided below.\n\n``` sql\nSELECT COUNT(*) AS canceled_flights\nFROM al_perf\nWHERE Cancelled = 1;\n```\n# Question 6b\n\n** For each departure airport, find the most frequent cancellation reason.**\n```sql\nWITH cancel_counts AS (\n    SELECT \n        OriginCityName AS airport_name,\n        Origin AS airport_code,\n        CancellationCode AS reason,\n        COUNT(*) AS cancel_count\n    FROM al_perf\n    WHERE Cancelled = 1\n    GROUP BY OriginCityName, Origin, CancellationCode\n),\nranked AS (\n    SELECT\n        airport_name,\n        airport_code,\n        reason,\n        cancel_count,\n        RANK() OVER (\n            PARTITION BY airport_name\n            ORDER BY cancel_count DESC\n        ) AS rnk\n    FROM cancel_counts\n)\nSELECT\n    airport_name,\n    airport_code,\n    reason,\n    cancel_count\nFROM ranked\nWHERE rnk = 1\nORDER BY airport_name;\n```\n\n## Output\n\nThe output of this SQL query is saved as `Question 6b output.csv`, and is provided below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nq6b <- read_csv(\"data/Question 6b output.csv\")\nq6b\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 313 × 4\n   airport_name                   airport_code reason cancel_count\n   <chr>                          <chr>        <chr>         <dbl>\n 1 Abilene, TX                    ABI          C                 1\n 2 Aguadilla, PR                  BQN          B                 3\n 3 Akron, OH                      CAK          B                19\n 4 Albany, NY                     ALB          B                61\n 5 Albuquerque, NM                ABQ          B                 9\n 6 Alexandria, LA                 AEX          C                 2\n 7 Alexandria, LA                 AEX          B                 2\n 8 Allentown/Bethlehem/Easton, PA ABE          B                19\n 9 Alpena, MI                     APN          A                 1\n10 Amarillo, TX                   AMA          C                 3\n# ℹ 303 more rows\n```\n\n\n:::\n:::\n\n\n\n## Visualization\n\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# ----------------------------\n# Load Q6b cancellation data\n# ----------------------------\nq6b <- read_csv(\"data/Question 6b output.csv\")\n\n# ----------------------------\n# Load FAA/OpenFlights Airport Coordinates\n# ----------------------------\nfaa_airports <- read_csv(\n  \"https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat\",\n  col_names = FALSE\n) %>%\n  select(\n    airport_id = X1,\n    airport_name = X2,\n    city = X3,\n    country = X4,\n    IATA = X5,\n    latitude = X7,\n    longitude = X8\n  ) %>%\n  filter(country == \"United States\", !is.na(IATA), IATA != \"\\\\N\")\n\n# ----------------------------\n# Join Q6b cancellations with airport coordinates\n# ----------------------------\nq6_map <- q6b %>%\n  left_join(faa_airports, by = c(\"airport_code\" = \"IATA\"))\n\n# ----------------------------\n# Plot U.S. map with cancellation bubbles\n# ----------------------------\nstates_map <- map_data(\"state\")\n\nggplot() +\n  geom_polygon(\n    data = states_map,\n    aes(x = long, y = lat, group = group),\n    fill = \"gray95\", color = \"white\"\n  ) +\n  geom_point(\n    data = q6_map,\n    aes(x = longitude, y = latitude, size = cancel_count),\n    color = \"#4C72B0\", alpha = 0.7\n  ) +\n  scale_size_continuous(range = c(2, 10)) +\n  coord_fixed(1.3) +\n  labs(\n    title = \"Flight Cancellations by Airport (Q6b)\",\n    x = \"Longitude\",\n    y = \"Latitude\",\n    size = \"Cancellation Count\"\n  ) +\n  theme_minimal(base_size = 14)\n```\n\n::: {.cell-output-display}\n![](q6_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nThe map shows how flight cancellations in March 2018 are distributed across U.S. airports, with larger points indicating airports experiencing higher cancellation volumes. Most cancellations cluster around major hubs in the eastern and central United States, where traffic density is highest. A few western airports also show elevated cancellation counts, highlighting how both weather patterns and congestion can drive regional differences in flight disruptions.\n",
    "supporting": [
      "q6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}